/* v3.5 JSON-first + Viewer */
:root{ --bg:#0b0b0b; --panel:#111; --ink:#fff; --ink-dim:#bfbfbf; --line:#1f1f1f; }
*{box-sizing:border-box} html,body{height:100% }
body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;padding-bottom:env(safe-area-inset-bottom) }
.shell{max-width:1120px;margin:0 auto;padding:0 16px}
header.shell{display:flex;align-items:center;justify-content:space-between;gap:10px;min-height:64px;border-bottom:1px solid var(--line);background:#0e0e0e;position:sticky;top:0;z-index:10}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:36px;height:36px;border-radius:10px;border:1px solid var(--line);display:grid;place-items:center;font-weight:800}
.nav{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.btn{position:relative;background:#151515;border:1px solid var(--line);color:#fff;padding:12px 14px;border-radius:12px;cursor:pointer;white-space:nowrap;touch-action:manipulation}
.btn:hover{background:#1a1a1a;transform:translateY(-1px);transition:transform .18s,background .18s}
.btn.ghost{background:transparent}
.btn.danger{border-color:#3a1e1e;color:#ffbdbd}
.btn.primary{border-color:#2b3bff;color:#cfd4ff}
.btn.sm{padding:8px 10px;border-radius:10px;font-size:14px}
.btn.xl{padding:14px 16px;font-size:16px}
.file-btn{position:relative;overflow:hidden}
.file-btn input{position:absolute;inset:0;opacity:0;cursor:pointer;-webkit-appearance:none;appearance:none}
.hidden-import{position:fixed;left:-9999px;top:-9999px;opacity:0;width:1px;height:1px}

.badge{font-size:12px;border:1px solid #2a2a2a;padding:6px 8px;border-radius:10px;color:#bfbfbf}

.panel{padding:14px 16px 10px;border-bottom:1px solid var(--line);background:var(--panel)}
.filters{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.search{flex:1 1 340px;background:#0e0e0e;border:1px solid var(--line);color:#fff;padding:12px 14px;border-radius:12px;min-width:0}
.muted{color:#bfbfbf}
.titleInput{flex:1 1 320px;background:transparent;color:#fff;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font:600 18px/1.2 ui-sans-serif, system-ui}

.grid{list-style:none;margin:0;padding:18px 0 24px;display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
.card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#111;display:flex;flex-direction:column;position:relative}
.media{background:#0f0f0f}
.thumb{width:100%;aspect-ratio:4/3;object-fit:cover;display:block}

.sel{position:absolute;top:10px;left:10px;display:flex;align-items:center;gap:6px;background:#0e0e0ee6;border:1px solid #2a2a2a;border-radius:10px;padding:4px 6px}
.sel input{width:16px;height:16px}
.sel span{font-size:12px;color:#bbb}

.meta{padding:12px;display:grid;gap:10px}
.title,.desc,.tags{width:100%;background:#0e0e0e;color:#fff;border:1px solid var(--line);padding:10px 12px;border-radius:12px;font-size:16px}
.desc{resize:vertical;min-height:44px}
.actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

.foot{padding:14px 16px 24px;border-top:1px solid var(--line);color:#8d8d8d}

/* --- Full-screen viewer --- */
#viewer{
  position:fixed; inset:0; background:rgba(0,0,0,.95);
  display:none; align-items:center; justify-content:center; z-index:9999;
}
#viewer.on{ display:flex }
#viewer .v-img{
  max-width: min(96vw, 1600px);
  max-height: 88vh;
  object-fit: contain;
  box-shadow: 0 8px 40px rgba(0,0,0,.6);
}
#viewer .v-prev, #viewer .v-next, #viewer .v-close{
  position:absolute; background:#101010e0; border:1px solid #2a2a2a; color:#fff;
  width:44px; height:44px; border-radius:12px; display:grid; place-items:center; cursor:pointer;
  font-size:24px;
}
#viewer .v-prev{ left:16px; top:50%; transform:translateY(-50%); }
#viewer .v-next{ right:16px; top:50%; transform:translateY(-50%); }
#viewer .v-close{ top:16px; right:16px; font-size:18px; }
#viewer .v-count{
  position:absolute; bottom:16px; left:50%; transform:translateX(-50%);
  font-size:12px; color:#ddd; background:#101010e0; border:1px solid #2a2a2a; padding:6px 10px; border-radius:10px;
}

#log{position:fixed;bottom:12px;left:12px;right:12px;max-height:40vh;overflow:auto;background:#0e0e0e;border:1px solid #222;border-radius:10px;padding:8px 10px;
     color:#ddd;font:12px/1.35 ui-monospace,SFMono-Regular,Menlo,monospace;display:none;z-index:99}
#log.show{display:block}

@media (max-width: 430px){
  header.shell{flex-wrap:wrap;padding-top:8px;padding-bottom:8px}
  .btn{padding:12px 12px;font-size:15px}
  .btn.xl{flex:1 1 100%}
  .nav .btn{flex:1 1 calc(50% - 5px); text-align:center}
  .search{flex:1 1 100%}
  .titleInput{font-size:16px}
  .grid{gap:12px}
}
@media (max-width: 360px){ .nav .btn{flex:1 1 100%} }


/* === Compact Icon Toolbar (single, top, scrollable) === */


.toolbar-scroll::-webkit-scrollbar{ display:none }


body{  } /* prevent overlap */


/* Top-right compact toolbar: ~25% width, horizontally scrollable */


.toolbar-scroll::-webkit-scrollbar{ display:none }


body{  } /* ensure content doesn't sit underneath */

/* Enlarged top-right pill, no separators */

.toolbar-scroll::-webkit-scrollbar{ display:none }


/* Logo pill */
.logo-pill{
  position:fixed; top:10px; left:10px; z-index:3100;
  font-weight:800; letter-spacing:.5px;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:#fff; background:#101010e6; border:1px solid #232323;
  padding:8px 10px; border-radius:12px;
  box-shadow: 0 8px 20px rgba(0,0,0,.35);
}

/* Seamless inner toolbar (no separators) */


.icon-btn:active svg{ transform: scale(.96) }
.icon-btn:hover svg{ opacity:1 }

/* Pill container (unchanged size, but no inner separators) */

.toolbar-scroll::-webkit-scrollbar{ display:none }

/* Status dot (top-left): green=online, blue=offline/cached */
#statusDot{
  position:fixed; top:12px; left:12px; z-index:3100;
  width:12px; height:12px; border-radius:50%;
  background:#27c93f; /* default green */
  box-shadow: 0 0 0 2px #0b0b0b, 0 0 10px rgba(0,0,0,.35);
}
#statusDot.offline{ background:#2b7bff } /* blue for offline (cached) */

/* Single compact pill toolbar â€” top-right, scrollable, no duplicates */


.toolbar-scroll::-webkit-scrollbar{ display:none }



.icon-btn:active svg{ transform: scale(.96) }


@media (max-width: 768px) {
  
  
  
}

/* ===== Stable, scrollable top-right pill with perfect alignment ===== */


.toolbar-scroll::-webkit-scrollbar{ display:none }

.icon-btn{
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: transparent;
  border: 0;
  color: #fff;
  border-radius: 10px;
}
.icon-btn svg{
  width: 22px; height: 22px; display:block; opacity:.98;
}

/* Tiny labels only on iPhone/small screens, with fixed container height */
.icon-label{
  display: none;
  font-size: 10px;
  color: #ccc;
  text-align: center;
  line-height: 12px;
  height: 12px;               /* reserve space so height stays stable */
  margin: 2px 0 0 0;
}

@media (max-width: 768px){
  
  .icon-btn{
    width: 48px;
    height: 56px;             /* stable button height */
    flex-direction: column;   /* stack icon over label */
  }
  .icon-btn svg{
    margin: 0 0 2px 0;
  }
  .icon-label{
    display: block;
  }
}

/* Ensure page content doesn't hide under the fixed pill */
body{ 

/* Reserve space for the fixed top-right toolbar so it doesn't cover the header/title */
body{ padding-top: 110px; }           /* desktop/tablet */
@media (max-width: 768px){
  body{ padding-top: 128px; }         /* iPhone: toolbar is taller due to labels */
}

/* Smaller Gallery title and more spacing from top nav */
.gallery-title, h1 {
  font-size: 1.8rem; /* smaller than default */
  margin-top: 0;
  margin-bottom: 12px;
}
@media (max-width: 768px) {
  .gallery-title, h1 {
    font-size: 1.5rem;
    margin-bottom: 10px;
  }
}

/* === Toolbar sizing (stable) === */
.toolbar-scroll{
  display: inline-flex;
  align-items: center;
  gap: 10px;
  width: 25vw;
  max-width: 420px;
  min-width: 220px;
  height: 56px;                /* desktop height */
  padding: 8px 10px;
  background: #0e0e0ee6;
  border: 0;
  border-radius: 16px;
  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  box-shadow: 0 10px 28px rgba(0,0,0,.38);
  

  /* Snap scrolling */
  scroll-snap-type: x mandatory;
  scroll-padding: 10px;
}
.toolbar-scroll::-webkit-scrollbar{ display:none }

.icon-btn{
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: transparent;
  border: 0;
  color: #fff;
  border-radius: 10px;

  /* Snap children to center */
  scroll-snap-align: center;
}
.icon-btn svg{
  width: 22px; height: 22px; display:block; opacity:.98;
}
.icon-label{ display:none; }

/* Mobile: taller bar with labels under icons */
@media (max-width: 768px){
  .toolbar-scroll{
    height: 68px;              /* slightly smaller than before to fix feel */
    padding: 6px 8px;
  }
  .icon-btn{
    width: 46px;
    height: 54px;
    flex-direction: column;
  }
  .icon-btn svg{ margin: 0 0 2px 0; }
  .icon-label{
    display:block;
    font-size:10px; color:#ccc; line-height:12px;
    height:12px; margin:2px 0 0 0; text-align:center;
  }
}

/* Top placement */


/* Adjust page padding so title/content don't collide */
body{ padding-top: 88px; }
@media (max-width: 768px){
  body{ padding-top: 106px; }
}

/* Keep header as the positioning context */
header.shell{ position: sticky; top: 0; z-index: 2000; display:flex; align-items:center; min-height:64px; border-bottom:1px solid var(--line); background:#0e0e0e; }
.brand{ display:flex; align-items:center; gap:10px; }
.logo{ width:36px;height:36px;border-radius:10px;border:1px solid var(--line);display:grid;place-items:center;font-weight:800 }

/* Toolbar lives inside header, top-right, vertically centered */
.top-toolbar{
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
}
/* Pill */
.toolbar-scroll{
  display: inline-flex;
  align-items: center;
  gap: 10px;
  width: 25vw; max-width: 420px; min-width: 220px;
  height: 50px;                 /* fits within 64px header */
  padding: 6px 8px;
  background:#0e0e0ee6;
  border:0; border-radius:16px;
  white-space: nowrap;
  overflow-x:auto; overflow-y:hidden;
  -webkit-overflow-scrolling: touch;
  box-shadow: 0 10px 28px rgba(0,0,0,.38);
  

  /* Snap scrolling */
  scroll-snap-type: x mandatory;
  scroll-padding: 8px;
}
.toolbar-scroll::-webkit-scrollbar{ display:none }

.icon-btn{
  flex: 0 0 auto;
  display:flex; align-items:center; justify-content:center;
  width: 38px; height: 38px;
  background: transparent; border:0; color:#fff; border-radius:10px;
  scroll-snap-align: center;
}
.icon-btn svg{ width: 20px; height: 20px; display:block; opacity:.98 }

/* Labels only on iPhone/small screens, with stable height */
.icon-label{ display:none; font-size:10px; color:#ccc; text-align:center; line-height:12px; height:12px; margin-top:2px }
@media (max-width: 768px){
  .toolbar-scroll{ height: 62px; padding: 6px 8px; }
  .icon-btn{ width: 44px; height: 50px; flex-direction: column; }
  .icon-btn svg{ margin-bottom: 2px }
  .icon-label{ display:block }
}

/* No big body padding needed now that toolbar is inside header */
body{ padding-top: 0 }

/* --- iOS Safari: prevent SVG disappearing near bottom --- */
.top-toolbar{ z-index: 4000; isolation: isolate; }
.toolbar-scroll{
  will-change: transform;
  transform: translateZ(0);               /* promote to its own layer */
  background: #111111e6;                  /* opaque-ish to avoid backdrop bugs */
  /* No backdrop-filter on mobile to avoid GPU glitches */
}
.icon-btn svg{
  will-change: transform;
  transform: translateZ(0);
}

/* Keep it pretty on desktop where backdrop-filter is stable */
@media (min-width: 769px){
  .toolbar-scroll{
    /* If you really want blur on desktop, enable these: */
    /* -webkit-backdrop-filter: saturate(135%) blur(8px);
       backdrop-filter: saturate(135%) blur(8px); */
  }
}

/* Make sure header stays above everything even at bottom */
header.shell{ position: sticky; top:0; z-index: 3500; }
